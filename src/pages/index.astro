---
import Layout from "../layouts/Layout.astro";
import NavBar from "../layouts/NavBar.astro";
import APIForm from "../components/getApi";

const config = {
    apiurl: "http://localhost:3080/api/v1",
    appTitle: "Tipo TEST"
};

const fetchInfo = (apiPath) => {
    return fetch(`${config.apiurl}/${apiPath}`)
        .then(res => res.json())
        .catch(err => console.error(err))
}

const fetchResult = await fetchInfo('convocations');  
const convocations = fetchResult && fetchResult.data? fetchResult.data : [];

let busy = true;
const toggleButton = (e) => {
    console.log("clicked")
    e.preventDefault()
        busy = busy? false : true;

}
/* $form.addEventListener('submit', async (event) => {
    event.preventDefault()
    const {value} = $input
    if (!value) return
  
    $submit.setAttribute('disabled', '')
    $submit.setAttribute('aria-busy', 'true')

    const ipInfo = await fetchIpInfo(value);
    if (ipInfo) {
        $results.innerHTML = JSON.stringify(ipInfo, null, 2)
    }

    $submit.removeAttribute('disabled')
    $submit.removeAttribute('aria-busy')
}) */
---
<!-- Below is your "component template." It's just HTML, but with
     some magic sprinkled in to help you build great templates. -->

<Layout title={config.appTitle}>
    <main class="container">
        <NavBar title={config.appTitle}></NavBar>     
        <section>
            <select>
                {convocations.map(convocation => (
                    <option value={convocation._id}>{convocation.name}</option>
                  ))}
            </select>
            <details>
                <summary>Últimos Tests</summary>
                <ul>
                  <li>…</li>
                  <li>…</li>
                </ul>
              </details>              
        </section>
        <section>
            <APIForm client:load></APIForm>
        </section>
    </main>
</Layout>